<link rel="import" href="../../bower_components/firebase-element/firebase-collection.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">


<dom-module id="data-controller">

<template>

    <firebase-collection id="languagesRef"
                             location="{{langLocation}}"
                             data = "{{languages}}">
    </firebase-collection>
    
    <firebase-collection id="categoriesRef"
                             location="{{catLocation}}"
                             data = "{{categories}}">
    </firebase-collection>
    
    <firebase-collection id="sentencesRef"
                             location="{{sentLocation}}"
                             data = "{{sentences}}">
    </firebase-collection>

    <firebase-auth id="auth" provider="password"
					location="{{location}}"
					status-known="{{statusKnown}}"
					user="{{user}}"
					on-error="loginError"
					ref="{{authRef}}">
		</firebase-auth>


    <template is="dom-repeat" items="{{categories}}" as="category">
		<div>{{category.italiano}} </div>
    </template> 

    <paper-button on-tap="login" raised>LOGIN</paper-button>
    <paper-button on-tap="logout" raised>LOGOUT</paper-button>
    <paper-label  raised>{{user.uid}}</paper-label>

</template>

<script>

	Polymer({

		is: "data-controller", 

		properties: {
				languages: {
                    type: Array, 
                    notify: true
                },
                categories: {
                    type: Array, 
                    notify: true
                },
                sentences: Array,
				location: String,
				user: {
			        type: Object,
			        notify: true, 
			    	observer: '_userChanged'
			        
			    },
				authRef: {
					type: Object, 
					notify: true
				}
		},
        
        _computeQuery: function(location){
            var query;
            query = new Firebase(location);
            return query;
        },

		showLocation: function(){
			console.log(this.location);
		},

		logout: function(){

				this.$.auth.logout();
                
                console.log('disconnesso!');
		},

		login: function(){
			this.$.auth.login({email: 'walter.miani@gmail.com', password: 'walter.miani@gmail.com'});
            
            this.location = this.location;
            
            this.notifyPath('location', this.location.slice());  
		},

		_userChanged: function(){

				if (this.statusKnown && this.user){
                    
                    this.langLocation = this.location + 'Languages';
                    this.catLocation = this.location + 'Categories';
                    this.sentLocation = this.location + 'Sentences';
				}
		},

		showAuth: function(){
			console.log(this.authRef);
		}

		


		
	});

</script>

</dom-module>