<link rel="import" href="../../bower_components/firebase-element/firebase-collection.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">


<dom-module id="languages-manager">

<template>

<style is="custom-style">


</style>

	

</template>

<script>

	Polymer({

		is: "user-manager", 


		properties: {
			uid: {
				type: String
			},
			userData: {
				type: Object,
				value: { displayName: "Anonymous"},
				reflectToAttribute: true
			},
			location: {
				type: String
			}
		},

		ready: function(){
			document.addEventListener('obrigado', function(e){
			
	// setta gli obrigado sulle frasi dell utente

			console.log('dentro al writer frasi');
			console.log(e.detail.location);

			var ref = new Firebase(e.detail.location + 'Users/');
			
			var path = ref.getAuth().uid.toString() + '/frasi/';

			console.log(path);

			ref.child(path).push({firebaseKey: e.detail.data.__firebaseKey__});

			});
		},

		setLogin: function(){

			console.log('inizializing user profile');

			var ref = new Firebase(this.location + 'Users/');

			// preparo un profilo iniziale con solo una frase fake
			var frasi = [{vuoto: 0}];
			var data = {name: this.userData.google.displayName, frasi: frasi};
			var uid = ref.getAuth().uid;

			// se l'utente è già in db, non faccio niente
			ref.once("value", function(snapshot){
				
				if(!snapshot.child(uid).exists()){
				console.log('user not found, setting new profile');
				ref.child(ref.getAuth().uid.toString()).set(data);
				}
				else{
					console.log('user found!');
				}
			});

			
			
			
				
		},

		setObrigadoOnSentence: function(firebaseKey){
			console.log("adding Obrigado to sentence:" + firebaseKey);
		},
		removeObrigadoFromSentence: function(firebaseKey){
			console.log("removing Obrigado from sentence:" + firebaseKey);
		},
		getDisplayName: function(){

			console.log("retrieving display name");

			console.log(this.userData);
			return this.userData.google.displayName;
		}
	});

</script>

</dom-module>